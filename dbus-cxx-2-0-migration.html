<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dbus-cxx: dbus-cxx 2.0 Migration Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="favicon.svg" />
<link rel="shortcut icon" href="favicon.ico" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="dbus-cxx-logo-doxygen.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dbus-cxx
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dbus-cxx-2-0-migration.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">dbus-cxx 2.0 Migration Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__home_robert_dbus_cxx_doc_80_migration"></a></p>
<h1><a class="anchor" id="autotoc_md56"></a>
Migration</h1>
<p >Migrating code to the 2.0 version of dbus-cxx should be pretty straightforward. The library must now be built with the libsigc++ version 3.0. This also means that you need a compiler that supports C++17.</p>
<p >This now means that argument lists of an arbitrary length can be used, instead of the previous hard limit of 7.</p>
<p >Most typedefs have also been removed, and you use <code>std::shared_ptr</code> directly to handle smart pointers.</p>
<p >The syntax for declaring methods has now also changed slightly: instead of having the first template parameter be the return value, the types now correspond to method signatures. This is for compatability with libsigc++ version 3.0.</p>
<p >You must also explicitly define what thread methods need to be called from to ensure proper multithreading.</p>
<h2><a class="anchor" id="autotoc_md57"></a>
Migration Example</h2>
<p >Given the following code with version 1: </p><div class="fragment"><div class="line">DBus::Object::pointer <span class="keywordtype">object</span> = <a class="code hl_variable" href="recursive-signal-test-qt_8cpp.html#a4256240e08bc2043e1c1e6984478d0d6">conn</a>-&gt;create_object(<span class="stringliteral">&quot;/dbuscxx/example/Calculator&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">object</span>-&gt;create_method&lt;double,double,<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;Calculator.Basic&quot;</span>, <span class="stringliteral">&quot;add&quot;</span>, sigc::ptr_fun(add) );</div>
<div class="ttc" id="arecursive-signal-test-qt_8cpp_html_a4256240e08bc2043e1c1e6984478d0d6"><div class="ttname"><a href="recursive-signal-test-qt_8cpp.html#a4256240e08bc2043e1c1e6984478d0d6">conn</a></div><div class="ttdeci">static std::shared_ptr&lt; DBus::Connection &gt; conn</div><div class="ttdef"><b>Definition:</b> recursive-signal-test-qt.cpp:30</div></div>
</div><!-- fragment --><p >This code now becomes: </p><div class="fragment"><div class="line">std::shared_ptr&lt;DBus::Object&gt; <span class="keywordtype">object</span> = <a class="code hl_variable" href="recursive-signal-test-qt_8cpp.html#a4256240e08bc2043e1c1e6984478d0d6">conn</a>-&gt;create_object(<span class="stringliteral">&quot;/dbuscxx/example/Calculator&quot;</span>, <a class="code hl_enumvalue" href="namespaceDBus.html#afe27044063df28784038ce01c2e7f525a5e4ad822bb12635d22f90ab2259ff7fa">DBus::ThreadForCalling::DispatcherThread</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">object</span>-&gt;create_method&lt;double(<span class="keywordtype">double</span>,<span class="keywordtype">double</span>)&gt;(<span class="stringliteral">&quot;Calculator.Basic&quot;</span>, <span class="stringliteral">&quot;add&quot;</span>, sigc::ptr_fun(add) );</div>
<div class="ttc" id="anamespaceDBus_html_afe27044063df28784038ce01c2e7f525a5e4ad822bb12635d22f90ab2259ff7fa"><div class="ttname"><a href="namespaceDBus.html#afe27044063df28784038ce01c2e7f525a5e4ad822bb12635d22f90ab2259ff7fa">DBus::ThreadForCalling::DispatcherThread</a></div><div class="ttdeci">@ DispatcherThread</div><div class="ttdoc">Always call methods for this object from the dispatcher thread.</div></div>
</div><!-- fragment --><p >You can use the <a href="auto-upgrade.sh">auto-upgrade.sh</a> script to help automate this</p>
<h2><a class="anchor" id="autotoc_md58"></a>
Type Changes</h2>
<p >For consistency with data types that can be sent over the <a class="el" href="namespaceDBus.html" title="Global DBus namespace, where everything happens.">DBus</a>, types such as <code>float</code> and <code>char</code> have been removed. <code>float</code> was removed as only IEEE-754 doubles may be sent over the bus; likewise, <code>char</code> is not a type that can be sent over, it is a <code>uint8_t</code>, or single byte.</p>
<p >The previous <code><a class="el" href="classDBus_1_1Variant.html" title="A Variant is a type-safe union for DBus operations.">DBus::Variant</a>&lt;&gt;</code> templated class has been removed and replaced with a version that is not templated.</p>
<p ><a class="el" href="namespaceDBus.html" title="Global DBus namespace, where everything happens.">DBus</a> structs map to <code>std::tuple</code>. Previously, there was no type for <code>struct</code>.</p>
<h2><a class="anchor" id="autotoc_md59"></a>
Backend Changes</h2>
<p >DBus-cxx is no longer a binding to <code>libdbus</code>, it is now a complete implementation. This was done partially to make it possible to store arrays(<code>std::vector</code>) and dictionaries (<code>std::map</code>) inside of <code><a class="el" href="classDBus_1_1Variant.html" title="A Variant is a type-safe union for DBus operations.">DBus::Variant</a></code>.</p>
<p >This also should allow for the fixing of known multithreading issues in <code>libdbus</code>.</p>
<h2><a class="anchor" id="autotoc_md60"></a>
API Changes</h2>
<p >A number of libsigc++ signals have been removed, as it was never defined what thread they would be emitted from, and they were not useful. For example, it was possible to change the name of interfaces and methods at run-time; this ability has been removed and the associated signals for the change were removed as well.</p>
<p >A number of methods were removed from the <code><a class="el" href="classDBus_1_1Connection.html" title="Connection point to the DBus.">DBus::Connection</a></code> class, as they just mapped directly to <code>libdbus</code> functionality that has not been re-implemented. If needed, methods can be brought back for needed use-cases.</p>
<p >When exporting objects, you must now be explicit about which thread to call the methods on this object from. This also necessitates a change to how the <code><a class="el" href="classDBus_1_1Dispatcher.html" title="A Dispatcher handles all of the reading/writing that a Connection needs in order to work correctly.">DBus::Dispatcher</a></code> class works.</p>
<h2><a class="anchor" id="autotoc_md61"></a>
API and ABI Compatibility</h2>
<p >As of version 2, it is intended that the API will be stable(or at least backwards- compatible), and that the library itself will be ABI compatible.</p>
<h1><a class="anchor" id="autotoc_md62"></a>
Major changes for dbus-cxx version 2.0</h1>
<ul>
<li>libdbus is no longer used; there is a new ground-up implementation for talking to the bus</li>
<li>C++17 is required to compile, due to using many C++17 features</li>
<li>Templated types now take in the template for the function signature(sigc++-3.0), and also can have an arbitrary number of arguments.</li>
<li>The library should now be ABI compatible, making it possible to easily upgrade</li>
<li>A new <a class="el" href="namespaceDBus_1_1priv.html" title="Private namespace for internal dbux-cxx implementation.">DBus::priv</a> namespace has been introduced; this namespace is intended for internal use only, and is not gauranteed to maintain any API/ABI compatible changes. Use any of the classes in this namespace at your own risk!</li>
<li>The threading model has been overhauled to ensure that methods will be called in the correct thread. You must now explicity state which thread methods should be called in.</li>
<li>New enums have been introduced to make programming more explicit</li>
<li>The introduction of <code>std::tuple</code> for a <a class="el" href="namespaceDBus.html" title="Global DBus namespace, where everything happens.">DBus</a> struct should eliminate the need for custom types</li>
<li>dbus-cxx-xml2cpp has been overhauled(again). This should allow for better code generation.</li>
<li>Added a <code>call_async</code> method to all <code><a class="el" href="classDBus_1_1MethodProxy.html">DBus::MethodProxy</a></code>s to make it easier to call methods in an async manner.</li>
<li>Fixed some circular dependencies for library classes - some classes could never be deleted due to circular <code>std::shared_ptr</code> references.</li>
<li>Added <code>operator&lt;&lt;</code> for many classes and enums to make debugging easier</li>
<li>Refactored code that used <code>pthread</code> objects to use <code>std::mutex</code>, <code>std::thread</code>, <code>std::unique_lock</code> as appropriate.</li>
<li>Added a large number of tests to ensure we don't break anything</li>
<li>Code generation will now output templated types correctly</li>
<li>Debug code for calling methods will demangle C++ names, so it should help identify what exactly method is being called</li>
<li>Exceptions thrown are no longer <code>std::shared_ptr</code>s</li>
<li>Many typedefs have been removed(see <a href="https://yarchive.net/comp/linux/typedefs.html">this thread</a> for justifications)</li>
</ul>
<h1><a class="anchor" id="autotoc_md63"></a>
Features Removed</h1>
<p >The following features have been removed. Generally, these features were removed because they are not believed to be widely used. If there is demand, they may be reimplmented in a new version</p>
<ul>
<li>Likely remove primary vs. fallback handling - doesn't really work well in an OO environment. If you want to have one object on multiple paths, you can export the object multiple times</li>
<li>Message filtering for an incoming message. Exactly how this was supposed to work was never well defined.</li>
<li>Having the same object exported on multiple connections. In all likelyhood this never worked properly in the first place, but there are some areas in the code which refer to it and is structured to potentially allow for it.</li>
<li>Many signals that give information about lifecycle state have been removed. Part of this is due to the signals potentially being emitted on the wrong thread, and part of this has to do with how often the signals are used. Note that 'signals' for this bullet point is talking about internal libsigc++ signals, not <a class="el" href="namespaceDBus.html" title="Global DBus namespace, where everything happens.">DBus</a> signals received from the bus. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
